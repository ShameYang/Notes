# 一、计算机网络概述

## 1.1 基本概念

网络（Network）是由若干结点（Node）和连接这些结点的链路（Link）组成

<img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E7%BD%91%E7%BB%9C.png" style="zoom: 67%;float:left" />



多个网络通过路由器互连起来，构成一个范围更大的网络，即互联网（互连网）(Network of Networks)

<img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E4%BA%92%E8%81%94%E7%BD%91.png" style="zoom: 67%;float:left" />



因特网（Internet）是世界上最大的互连网络

<img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E5%9B%A0%E7%89%B9%E7%BD%91.png" style="zoom:80%;float:left" />



Internet 和 internet 的区别

- Internet（因特网）是一个专用名词，指全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，采用 TCP/IP 协议作为通信的规则，前身是美国的 ARPANET
- internet（互联网或互连网）是一个通用名词，泛指由多个计算机网络互连而成的网络，这些网络间的通信协议是任意的



因特网发展三阶段

<img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E5%9B%A0%E7%89%B9%E7%BD%91%E5%8F%91%E5%B1%95%E4%B8%89%E9%98%B6%E6%AE%B5.png" style="zoom: 50%;float:left" />



ISP

- Internet Service Provider，因特网服务提供者，我国主要有移动、联通、电信

- 基于 ISP 的三层结构的因特网

  <img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E5%9F%BA%E4%BA%8EISP%E7%9A%84%E4%B8%89%E5%B1%82%E7%BB%93%E6%9E%84%E7%9A%84%E5%9B%A0%E7%89%B9%E7%BD%91.png" style="zoom: 80%; float: left;" />



计算机网络的标准化工作

- ISO 国际标准化组织：负责制定大型网络的标准
- ISOC 因特网协会：负责对因特网进行全面管理
  - IAB 架构委员会：负责管理因特网有关协议的开发
    - IETF 工程委员会：针对协议标准化
    - IRTF 研究任务委员会：进行理论方面的研究和开发一些需要长期考虑的问题







## 1.2 因特网的组成

边缘部分

由所有连接在 Internet 上的主机组成，用户可直接用来进行通信（传送数据、视频或音频）和资源共享

- 端系统间的通信方式：

  - C/S 客户端/服务器

    区分服务请求方和服务提供方

  - P2P 对等方式

    不区分服务请求方和服务提供方

核心部分

由大量网络和连接这些网络的路由器（router）组成，为边缘部分提供连通性和交换服务







## 1.3 三种交换方式

> 交换就是按照某种方式动态地分配传输线路的资源

电路交换

- 通话的两个用户始终占用端到端的通信资源，也就是平时打电话的“占线”

- 电路交换的三个步骤
  - 建立连接
  - 通话
  - 释放连接
- 优点：
  - 通信时延小
  - 有序传输
  - 没有冲突
  - 适用范围广
  - 实时性强
  - 控制简单
- 缺点：
  - 建立连接时间长
  - 线路独占，使用效率低
  - 灵活性差
  - 难以规格化

分组交换

- 计算机网络通常采用分组交换

- 报文是网络中交换与传输的数据单元，即站点一次性要发送的数据块

- 分组交换把报文划分成等长的数据段，可以称为“包”，每个数据段前都加上首部（包头）

  - 首部起着关键的作用：由一些控制信息组成，包含目的地址和源地址等重要信息

  - 各部分的任务

    发送方：构造分组、发送分组

    路由器（分组交换机）：存储转发（缓存分组和转发分组）

    接收方：接受分组、还原报文

- 优点：

  - 无需建立连接
  - 线路利用率高
  - 简化了存储管理
  - 加速传输
  - 减少出错率和重复数据量

- 缺点：

  - 引起了转发时延

  - 需要传输额外的信息量

  - 对于数据报服务，存在失序、丢失或重复分组的问题；

    对于虚电路服务，存在呼叫建立、数据传输和虚电路释放的过程
  
- 分组交换对报文交换的主要改进：传输单位更小，且有固定的最大长度

报文交换

- 早期的电报通信网经常使用，现在较少使用，通常被分组交换方式所取代
- 报文交换也采用存储转发的方式，不需要建立专用的通信线路，对报文的大小没有限制
- 优点：
  - 无需建立连接
  - 动态分配线路
  - 提高线路可靠性
  - 提高线路利用率
  - 提供多目标服务
- 缺点：
  - 引起了转发时延
  - 需要较大存储缓存空间
  - 需要传输额外的信息量
  - 只适用于数字信号







## 1.4 计算机网络的分类

按交换技术分类

- 电路交换网络
- 报文交换网络
- 分组交换网络

按使用者分类

- 公用网
- 专用网

按传输介质分类

- 有线网络
- 无线网络

按覆盖范围分类

- 广域网 WAN
- 城域网 MAN
- 局域网 LAN
- 个域网 PAN（无线个人局域网 WPAN）

按拓扑结构分类

拓扑，就是把实体抽象点，连接实体的线路抽象成线

- 总线型网络
- 星型网络
- 环型网络
- 网状型网络







## 1.5 计算机网络的性能指标

速率

- 比特

  - 计算机中数据量的单位

  - 常用数据量单位

    8 bit = 1 Byte

    KB = 2^10 B

    MB = 2^20 B

    GB = 2^30 B

    TB = 2^40 B

- 速率

  - 主机在数字信道上传送比特的速率，称为比特率或数据率

  - 常用数据率单位

    bit/s（b/s，bps）

    kb/s = 10^3 b/s

    Mb/s = 10^6 b/s

    Gb/s = 10^9 b/s

    Tb/s = 10^12 b/s

带宽

- 表示网络的通信线路所能传送数据的能力，因此网络带宽表示在单位时间内从网络的某一点到另一点所能通过的“最高数据率”
- 单位：b/s

吞吐量

- 吞吐量表示在单位时间内通过某个网络的数据量
- 吞吐量受网络的带宽或额定速率的限制

时延

- 发送时延

  - 发送时延 = 分组长度(b) / 发送速率(b/s)

- 传播时延

  - 传播时延 = 信道长度(m) / 电磁波传播速率(m/s)

  - 自由空间：3*10^8 m/s

    铜线：2.3*10^8 m/s

    光纤：2.0*10^8 m/s

- 处理时延（排队时延）

  - 一般不方便计算

时延带宽积

- 时延带宽积 = 传播时延 * 带宽

往返时间（RTT）

利用率

- 信道利用率：表示某信道有百分之几的时间是被利用的（有数据通过）

  D = D<sub>0</sub> / 1-U

  D：网络当前的时延

  D<sub>0</sub>：网络空闲时的时延

  U：信道利用率

- 网络利用率：全网络的信道利用率的加权平均
  - 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增加
  - 所以，信道利用率并非越高越好

丢包率

- 丢包率即分组丢失率，指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率
- 丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等
- 分组丢失主要有两种情况：
  - 分组在传输过程中出现误码，被结点丢弃
  - 分组到达一台队列已满的分组交换机时被丢弃；在通信量较大时可能造成网络拥塞







## 1.6 计算机网络体系结构

### 常见的计算机体系结构

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

#### OSI 体系结构

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png)

#### TCP/IP 体系结构

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/TCPIP%E5%8D%8F%E8%AE%AE.png)



### 分层的必要性

> 在最初的 ARPANET 设计时就提出了分层的概念

计算机网络是个非常复杂的系统

分层可将庞大复杂的问题，转化为若干较小的局部问题，比较易于研究和处理



#### 原理体系结构

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E5%8E%9F%E7%90%86%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%88%86%E5%B1%82.png)



#### 物理层

采用怎样的传输媒体

采用怎样的物理接口

使用怎样的信号表示比特0和1



#### 数据链路层

如何标识网络中的各主机（主机编址问题，例如 MAC 地址）

如何从比特流中区分出地址和数据

如何协调各主机争用总线



#### 网络层

如何标识各网络以及网络中的主机（网络和主机共同编址的问题，例如 IP 地址）

路由器如何转发分组，如何进行路由选择



#### 运输层

如何解决进程之间基于网络的通信问题

出现传输错误时，如何处理



#### 应用层

通过应用进程间的交互完成特定的网络应用



### 计算机网络体系结构专用术语

#### 实体

实体：任何可发送或接收信息的硬件或软件进程

对等实体：收发双方相同层次中的实体



#### 协议

协议：控制两个对等实体进行逻辑通信的规则的集合

协议三要素：语法、语义、同步

- 语法：定义所交换信息的格式
- 语义：定义收发双方所要完成的操作
- 同步：定义收发双方的时序关系



#### 服务

关于服务：

- 在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务

- 实现本层协议，需要使用下面一层所提供的服务

- 协议是“水平的”，服务是“垂直的”

- 下层的协议对上层“透明”：实体看得见相邻下层提供的服务，但不知道实现该服务的具体协议

服务访问点：在同一系统中，相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型

- 数据链路层的服务访问点为帧的“类型字段”
- 网络层的服务访问点为 IP 数据报首部的“协议字段”
- 运输层的服务访问点为“端口号”

服务原语：上层使用下层提供的服务，与下层交换一些命令

协议数据单元 PDU：对等层次间传送的数据包

服务数据单元 SDU ：同一系统内，层与层之间交换的数据包







# 二、物理层

## 2.1 物理层的基本概念

物理层考虑怎样能在连接各种计算机的传输媒体上传输数据比特流

物理层为数据链路层屏蔽了各种传输媒体的差异，使其只需考虑如何完成本层的协议和服务



物理层协议的主要任务：

- 机械特性：指明接口所用接线器的**形状**和**尺寸**、**引脚数目**和**排列**、**固定**和锁定装置
- 电气特性：指明在接口电缆的各条线上出现的**电压的范围**
- 功能特性：指明某条线上出现的某一电平的**电压表示的意义**
- 过程特性：指明对于不同功能的各种可能**事件的出现顺序**



## 2.2 物理层下面的传输媒体

传输媒体分为以下两类：

导引型传输媒体

- 同轴电缆

  特点：价格较贵且布线不够灵活方便

  基带同轴电缆（50Ω）过去用于局域网，随着集线器的出现，局域网领域基本上都是采用双绞线

  宽带同轴电缆（75Ω）目前主要用于有线电视

- 双绞线

  双绞线分为无屏蔽双绞线和屏蔽双绞线

  绞合的作用：抵御外界电磁波干扰，减少相邻导线的电磁干扰

- 光纤

  优点

  - 通信容量大
  - 传输损耗小，远距离传输时更经济
  - 抗雷电和电磁干扰性能好
  - 无串音干扰，保密性好，不易被窃听
  - 体积小，重量轻

  缺点

  - 割接需要专用设备
  - 光电接口价格较贵

- 电力线



非导引型传输媒体

- 无线电波

- 微波

  特点：直线传播

- 红外线

- 可见光



## 2.3 传输方式

串行传输

并行传输



同步传输

- 收发双方时钟同步的方法

  外同步：收发双方间添加一条单独的时钟信号线

  内同步：发送端将时钟同步信号编码到发送数据中一起传输（例如曼彻斯特编码）

异步传输

- 字节之间异步（字节之间的时间间隔不固定）
- 字节中的每个比特仍要同步（各比特的持续时间相同）



单向通信（单工）

- 例如：无线电广播

双向交替通信（半双工）

- 例如：对讲机

双向同时通信（全双工）

- 例如：手机



## 2.4 编码与调制

信号：数据的电磁表现

基带信号：信源发出的原始电信号

- 数字基带信号（CPU 与内存之间传输的数字信号）
- 模拟基带信号（麦克风收到声音后产生的音频信号）

信号需要在信道中传播，信道分为：

- 数字信道
- 模拟信道

编码：在不改变信号性质的前提下，仅对基带信号的波形进行变换

- 编码后产生数字信号，在数字信道中传输
- 数字基带信号：以太网（使用曼彻斯特编码、4B/5B、8B/10B 等编码）
- 模拟基带信号：对音频信号进行编码的脉码调制 PCM（将模拟音频信号进行数字化）

调制：把数字基带信号的频率范围搬移到较高的频段，并转换为模拟信号

- 调制后产生模拟信号，在模拟信道中传输
- 数字基带信号：WIFI（CCK/DSSS/OFDM 调制）
- 模拟基带信号：语音数据加载到模拟的载波信号中传输（电话）；频分复用 FDM 技术，充分利用带宽资源

码元：构成信号的一段波形



**常用编码**

不归零编码

归零编码

曼彻斯特编码（传统以太网，10Mb/s）

- 码元中间时刻的跳变既表示时钟，又表示数据

差分曼彻斯特编码（更适合较高的传输速率）

- 码元中间时刻的跳变仅表示时钟
- 码元开始处电平是否发生改变表示数据，发生改变为0，不发生改变为1



## 2.5 信道的极限容量

**奈氏准则**：在假定的理想条件下，为了避免码间串扰，码元传输速率是有上限的

理想低通信道的最高码元传输速率 = 2W Baud = 2W 码元/秒

理想带通信道的最高码元传输速率 = W Baud = W 码元/秒

- W：信道带宽（Hz）
- Baud：波特，即码元/秒

码元传输速率又称为波特率、调制速率、波形速率或符号速率

- 与比特率的关系：bps = Baud * n（n 为1个码元携带比特的数量）



**香农公式**：带宽受限且有高斯白噪声干扰的信道的极限信息传输速率

c = W * log2(1+S/N)

- c：信道的极限信息传输速率

- W：信道带宽（Hz）

- S：信道内所传信号的平均功率

- N：信道内的高斯噪声功率

- S/N：信噪比

  > 注意：S/N 是无单位信噪比，...dB 是有单位的信噪比

  信噪比(dB) = 10 * log10(S/N)







# 三、数据链路层

## 3.1 数据链路层概述

链路：从一个结点到相邻节点的一段物理线路，中间没有任何其他交换的交换结点

数据链路：把实现通信协议的硬件和软件加到链路上

数据链路层以帧为单位传输和处理数据



## 3.2 封装成帧

封装成帧：数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧

- 帧头和帧尾包含重要的控制信息，其作用之一是帧定界

透明传输：数据链路层对上层交付的传输数据没有任何限制

- 面向字节的物理链路使用字节填充（字符填充）的方式实现透明传输
- 面向比特的物理链路使用比特填充（每5个连续1后边插入一个比特0）

为了提高帧的传输效率，应使帧的数据部分长度尽可能大些

每一种数据链路协议都规定了帧数据部分的长度上限，即最大传送单元 MTU（Maximum Transfer Unit）



## 3.3 差错检测

实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能会变成0，0可能变成1，我们称之为比特差错

误码率 BER：Bit Error Rate，一段时间内，传输错误的比特占比特总数的比率

使用差错检测来检验数据在传输过程中是否产生比特差错，是数据链路层要解决的重要问题之一



奇偶校验（一般不采用）：在待发送的数据后边添加1位奇偶校验位

循环冗余校验 CRC（Cyclic Redundancy Check）

- 收发双方约定好一个生成多项式 G(x)
- 发送方基于待发送的数据和生成多项式计算出差错检测码（冗余码），将其添加到待传输数据后边一起传输
- 接收方通过生成多项式来计算收到的数据是否产生误码

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%B7%AE%E9%94%99%E6%A3%80%E6%B5%8BCRC.png)

检错码只能检测帧在传输过程是否出现差错，不能定位错误，因此不能纠正错误

要想纠错，可以使用冗余信息更多的纠错码进行前向纠错，但纠错码的开销很大，在计算机网络中较少使用

后续将学习检错重传方式来纠正传输中的差错，或丢弃检测到差错的帧，取决于数据链路层向上层提供的是可靠传输服务还是不可靠传输服务



## 3.4 可靠传输

### 可靠传输的基本概念

数据链路层向上层提供的服务：

- 不可靠传输服务：仅丢弃有误码的帧
- 可靠传输服务：想办法实现发送端发什么，接收端就收到什么

有线链路误码率低，为了减小开销，不要求数据链路层向上提供可靠传输服务。如果出现误码，可靠传输的问题由上层解决

无线链路易受干扰，误码率高，因此数据链路层必须向上提供可靠传输服务

比特差错只是传输差错的一种，在整个计算机网络体系结构中，还有分组丢失、分组失序以及分组重复（一般出现在上层）

可靠传输服务在其他各层都可选择实现，并不局限于数据链路层



### 停止-等待协议 SW

停止-等待协议 SW（Stop-and-Wait）是可靠传输的一种实现机制

通过确认和重传机制实现的可靠传输协议，常称为自动重传 ARQ（Automatic Repeat reQuest）协议

① 发送方发送数据

② 接收方确认是否误码并返回确认分组，没有误码返回 ACK 分组，误码返回 NAK 分组

③ 发送方收到分组，如果出现误码则重传数据



分组丢失怎么办？

- 利用超时计时器，设置重传时间，如果超时则重新发送数据
- 一般重传时间略大于收发双方的平均往返时间

为了让收发双方判断收到的分组是否重复，应为每个分组编号



信道利用率 U = 数据帧发送时延 / 数据帧发送时延 + RTT + 传播时延

停止-等待协议的信道利用率很低，于是产生了两种协议：回退 N 帧协议 GBN 和选择重传协议 SR



### 回退 N 帧协议 GBN

回退 N 帧协议 GBN（Go-Back-N）是可靠传输的一种实现机制

在流水线传输的基础上利用发送窗口来限制连续发送数据分组的数量，是一种连续 ARQ 协议，又称为滑动窗口协议

在通信线路质量不好时，信道利用率并不高

发送方

- 发送窗口的尺寸：1 < W<sub>T</sub> <= 2<sup>n</sup>-1

  n 是构成分组序号的比特数量

  - W<sub>T</sub> = 1 停止-等待协议
  - W<sub>T</sub> > 2<sup>n</sup>-1 接收方无法分辨新、旧数据分组

- 发送方只有收到确认时，窗口才会向前滑动

- 发送窗口中已发送的数据分组如果超时重传，发送窗口中其他已发送的数据也必须重传，这就是回退 N 帧协议名称的由来

接收方

- 接收窗口的尺寸 W<sub>R</sub> = 1，因此只能按序接收数据分组
- 接收方可以累计确认：连续收到按序到达且无误的数据分组后，针对最后一个数据分组发送确认分组
- 也可以捎带确认：自己有数据分组要发送时，才发送确认分组



### 选择重传协议 SR

选择重传协议 SR（Selective Request） 是对回退 N 帧协议的改进，接收窗口的尺寸大于1，以便节约通信资源

选择重传协议可以仅重传出现差错的分组，但是不能再采用累计确认，需要对每个正确接收到的数据分组逐一确认

发送方与回退 N 帧相同

接收方改进：

- 接收窗口尺寸 1 < W<sub>R</sub> <= W<sub>T</sub> 



## 3.5 点对点协议 PPP

点对点协议 PPP（Point-to-Point Protocol）是目前使用最广泛的点对点数据链路层协议

主要组成部分：

- 对各种协议数据报的封装方法（封装成帧）
- 链路控制协议 LCP：用于建立、配置以及测试数据链路的连接
- 网络控制协议 NCPs：其中的每个协议支持不同的网络层协议



#### **帧格式**

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-PPP%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)





#### **透明传输——面向字节的异步链路采用插入转义字符的字节填充法**

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-PPP%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93%E5%AD%97%E8%8A%82%E5%A1%AB%E5%85%85.png)

字节7E 作为帧的定界符

发送方处理：

- 数据部分7E 字节转变为2字节序列（7D，5E）
- 数据部分7D 字节转变为2字节序列（7D，5D）
- 数据部分 ASCII 码控制字符（数值小于0x20的字符），在字符前插入7D 字节，同时将字符编码加上0x20

接收方进行反变换处理即可得到原来的数据部分



#### **透明传输——面向比特的同步链路采用插入比特0的比特填充法**

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-PPP%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93%E6%AF%94%E7%89%B9%E5%A1%AB%E5%85%85.png)

发送方处理：对帧数据部分进行扫描，每5个连续比特1后，填充一个比特0

接收方处理：对帧数据部分进行扫描，发现5个连续比特1后，将其后边的比特0删除



## 3.6 媒体接入控制 MAC

### 媒体接入控制的基本概念

媒体接入控制 MAC（Medium Access Control）：用来协调多个发送和接收站点对一个共享传输媒体的占用

![](https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-MAC%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.png)



### 静态划分信道

信道复用

- 复用（Multiplexing）是通信技术中的一个重要概念，复用就是通过一条物理线路同时传输多路用户的信号

常见的信道复用技术：

- 频分复用 FDM

  所有用户同时占用不同的频带资源并行通信

- 时分复用 TDM

  所有用户在不同时间占用同样的频带宽度

- 波分复用 WDM

- 码分复用 CDM

  CDM 的每个用户可以在相同时间使用同样的频带进行通信

  该技术主要用于多址接入，码分多址 CDMA（Code Division Multiple Access）

  同理，频分复用也可用于多址接入：频分多址 FDMA、时分多址 TDMA

  某种程度上，..DMA 可以看作 ..DM 的应用

CDMA

- 每个比特时间划分为 m 个短的间隔，称为码片（Chip），通常为64或128

- 使用 CDMA 的每一个站被指派一个唯一的 m bit 码片序列

  - 一个站如果发送比特1，则发送自己的 m bit 码片序列
  - 一个站如果发送比特0，则发送自己的 m bit 码片序列的二进制反码

  码片序列中的0写为-1，1写为+1

  假设某个站点的码片序列为00001111，那么写为（-1,-1,-1,-1,+1,+1,+1,+1）

- 码片序列的挑选原则：各不相同、相互正交（规格化内积为0）

- 判断哪些站发送了数据？

  用收到的码片序列与各站的码片序列求内积，1表示发送了比特1，-1表示发送了比特0，0表示没有发送数据





### 随机接入—CSMA/CD 协议

> 总线局域网使用的协议

CSMA/CD（Carrier Sense Multiple Access/Collision Detection）：载波监听多址接入/碰撞检测

载波监听 CS：每个站在发送帧之前先检测总线上是否有其他站点在发送帧

- 若检测到总线空闲96比特时间，则发送该帧

多址接入 MA：多个站连接在一条总线上，竞争使用总线

碰撞检测 CD：每个正在发送数据的站边发送边检测碰撞

- 一旦总线上出现碰撞，立即停止发送，退避一段时间后再次发送

#### 争用期

主机最多经过 2τ （δ→0，τ 为单程端到端传播时延）的时长就可以检测到是否发生碰撞

2τ 称为争用期或碰撞窗口

#### 最小帧长

以太网规定最小帧长为64字节，即512比特

最小帧长确保主机可以在帧发送完成之前，就检测到帧的发送过程中是否遭遇了碰撞

最小帧长 = 争用期 * 数据传输速率

#### 最大帧长

以太网 V2的 MAC 帧：1518字节

插入 VLAN 标记后的802.1Q 帧：1522字节

<img src="https://cdn.jsdelivr.net/gh/ShameYang/images/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-CSMACD%E6%9C%80%E5%A4%A7%E5%B8%A7%E9%95%BF.png" style="zoom:50%;" />

#### 截断二进制指数退避算法

退避时间 = 争用期2τ * 随机数 r(0~2^k^ - 1，k=Min[重传次数, 10])

#### 信道利用率

极限信道利用率 S~max~ = T~0~ / T~0~ + τ 





### 随机接入—CSMA/CA 协议

> 无线局域网使用的协议

CSMA/CA（Carrier Sense Multiple Access/Collision Avoidance）：载波监听多址接入/碰撞避免

无线局域网中，由于无线信道的传输条件特殊，不能使用碰撞检测

802.11 无线局域网，使用 CSMA/CA 协议，在 CSMA 的基础上增加了碰撞避免 CA 功能

由于不可能避免所有的碰撞，而且无线信道的误码率较高，802.11 标准还使用了数据链路层确认机制（停止-等待协议）

#### 帧间间隔 IFS

802.11 标准规定，所有站点必须在持续检测到信道空闲一段时间后才能发送帧，这段时间称为帧间间隔 IFS(InterFrame Space)

#### 信道预约和虚拟载波监听

为了尽可能减少碰撞的概率，降低碰撞的影响，802.11 标准允许要发送数据的站点对信道进行预约

- 源站发送一个短的控制帧：请求发送 RTS(Request To Send)，包括源地址、目的地址和通信所需的持续时间
- 目的站收到 RTS 帧后，且媒体空闲，则发送一个响应控制帧：允许发送 CTS(Clear To Send)，包括通信所需的持续时间

数据帧也携带通信所需的持续时间，这称为802.11的虚拟载波监听机制

站点只要收到 RTS、CTS、数据帧中其中一个，就能知道信道被占用的持续时间，因此减少屏蔽站带来的碰撞问题
